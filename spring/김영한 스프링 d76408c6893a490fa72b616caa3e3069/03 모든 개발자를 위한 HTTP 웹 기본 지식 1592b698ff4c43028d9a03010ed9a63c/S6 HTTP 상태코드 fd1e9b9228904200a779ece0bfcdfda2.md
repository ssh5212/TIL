# S6 HTTP 상태코드

---

---

# HTTP 상태 코드

**클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능**

- ~~1xx (Informational): 요청이 수신되어 처리중~~ (거의 사용되지 않음)
- 2xx (Successful): 요청 정상 처리
- 3xx (Redirection): 요청을 완료하려면 추가 행동이 필요
- 4xx (Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 5xx (Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함

## 모르는 상태 코드가 나타나면?

- 가장 앞에 숫자를 보고 처리함
- 299 → 200번대니깐 정상이구나고 이해하고 처리함

→ 상위 상태코드 (2xx)로 이해하고 처리

# 2xx - 성공

- 200 OK : 정상적으로 처리
- 201 Created : 서버쪽에서 리소스 생성 (POST 등록 후 결과 반환 시)
- 202 Accepted
- 204 No Content

## 200 OK

요청 성공

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled.png)

## 201 Created

요청이 성공하여 새로운 리소스가 생성됨

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%201.png)

## 202 Accepted

요청이 접수되었으나 처리가 완료되지 않았음

- 배치 처리 같은 곳에서 사용
- ex) 요청 접수 후 1시간 뒤에 배치 프로세스가 요청 처리

## 204 No content

서버가 요청을 성공적으로 수행했지만, 응답 페이로 본문에 보낼 데이터가 없음

- 웹 문서 편집기에 저장 버튼
- 저장 버튼의 결과로 아무 내용이 없어도 됨
- 저장 버튼을 눌러도 같은 화면을 유지해야 함
- 결과 내용이 없어도 204는 2xx이므로 성공을 인식할 수 있음

→ 모든 코드를 다 사용하는 것이 좋은 것은 아님

- 팀에서 결정하고 사용함

# 3xx - 리다이렉션

요청을 완료하기 위해 유저 에이전트(클라이언트, 주로 웹 브라우저)의 추가 조치 필요

- ~~300 Multiple Choices (잘 안씀)~~
- 301 Moved Permanently
- 302 Found
- 303 See Other
- 304 Not Modified
- 307 Temporary Redirect
- 308 Permanent Redirect

## 리다이렉션 이해

- 웹 브라이주거 3xx 응답 결과에 location 헤더가 있으면, location 위치로 자동 이동함
    
    → 리다이렉트
    

주소가 바뀌었는데 기존 사용자들이 즐겨찾기로 사용하는 경우

→ 리다이렉트로 응답시켜주면 새로운 페이지로 이동함

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%202.png)

**종류**

- 영구 리다이렉션 - 특정 리소스의 URI가 영구적으로 이동
    - 예) /members -> /users
    - 예) /event -> /new-event
- 일시 리다이렉션 - 일시적인 변경
    - 주문 완료 후 주문 내역 화면으로 이동
    - PRG 패턴: Post/Redirect/Get
- 특수 리다이렉션 (캐시 기간 만료 등을 확인 할 때 사용함)
    - 결과 대신 캐시를 사용
    

## 영구 리다이렉션

301, 308 - 두 개다 경로가 완전히 바뀌었음을 알려줌

- 리소스의 URI가 영구적으로 이동했음을 알려줌
- 원래의 URL를 사용 불가, 검색 엔진 등에서도 변경 인지
- 301 Moved Permanently
    - **리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)**
- 308 Permanent Redirect
    - 301과 기능은 같음
    - **리다이렉트시 요청 메서드와 본문 유지(처음 POST를 보내면 리다이렉트도 POST 유지)**

## 301

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%203.png)

1) post를 이용하여 데이터를 전송함

2) 301로 넘김

3) 리다이렉트 전송 시 **get로 변경되어 서버에 요청**됨 (기존의 데이터는 모두 날아감)

4) 클라이언트 새로운 화면이 출력되며, 사용자는 다시 입력해야 함 

## 308

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%204.png)

새로운 URI로 요청 시 기존의 POST 데이터가 그대로 유지되어 함꼐 전달됨

실무에서는 거의 이렇게 사용하지 않고, 301을 사용함

→ URI가 바뀌는 경우는 대부분 받는 데이터가 바뀌기 떄문에

## 일시적 리다이렉션

302, 307, 303

- 리소스의 URI가 일시적으로 변경
- 따라서 검색 엔진 등에서 URL을 변경하면 안됨
- 302 Found
    - **리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)**
    
    → 따르지 않은 일부 브라우저는 제거가 되지 않을 수도 있음 → 대부분 변함
    
- 307 Temporary Redirect
    - 302와 기능은 같음
    - **리다이렉트시 요청 메서드와 본문 유지(요청 메서드를 변경하면 안된다. MUST NOT)**
    
    → POST라면 POST 유지, 데이터 유지
    
- 303 See Other
    - 302와 기능은 같음
    - **리다이렉트시 요청 메서드가 GET으로 변경**
    
    → 302가 get으로 확실하게 변경함되지 않으므로 → 하지만 99% 바뀌기 때문에 302을 많이 쓴다
    

## PRG: Post/Redirect/Get

일시적인 리다이렉션 예시

- POST로 주문 완료 후  웹 브라우저를 새로 고침한다면?
- 새로고침은 마지막 요청인 POST를 다시 요청함
- 중복 주문이 일어날 수 있음

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%205.png)

1) POST로 주문 후 200 OK가 돌아옴

2) 새로고침은 마지막 요청을 새로 고침함

3) POST가 다시 들어가고 주문 후 200 OK가 들어옴

→ 이 문제를 해결하기 위한 PRG 패턴

- POST로 주문후에 새로 고침으로 인한 중복 주문 방지해야 함
- POST로 주문후에 주문 결과 화면을 GET 메서드로 리다이렉트
- 새로고침해도 결과 화면을 GET으로 조회
    
    → 앞선 문제가 일어나지 않음
    
- 새로고침 하더라도 중복 주문 대신에 결과 화면만 GET으로 다시 요청

![Untitled](S6%20HTTP%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%90%E1%85%A2%E1%84%8F%E1%85%A9%E1%84%83%E1%85%B3%20fd1e9b9228904200a779ece0bfcdfda2/Untitled%206.png)

1) 주문 요청의 결과를 200 OK가 아니라 302 Found or 303로 넘김

2) 클라이언트가 자동으로 GET로 바꿔서 리다이렉트

3) 리다이렉트로 주문 정보를 조회하고 결과를 200OK로 클라이언트에 전달

4) 실수로 새로 고침을 하더라도 중복 주문이 일어나지 않음

POST - Redirect - Get

- URL이 이미 POST → GET으로 리다이렉트
- 새로고침해도 GET으로된 결과 화면만 조회할 수 있음

## 302, 307, 303 정리 (뭘 써야 하나)

- 302 Found -> GET으로 변할 수 있음
- 307 Temporary Redirect -> 메서드가 변하면 안됨
- 303 See Other -> 메서드가 GET으로 변경

- 역사
    - 처음 302 스펙의 의도는 HTTP 메서드를 유지하는 것
    - 그런데 웹 브라우저들이 대부분 GET으로 바꾸어버림(일부는 다르게 동작)
    - 그래서 모호한 302를 대신하는 명확한 307, 303이 등장함(301 대응으로 308도 등장)
- 현실
    - 307, 303을 권장하지만 현실적으로 이미 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용
    - 자동 리다이렉션시에 GET으로 변해도 되면 **그냥 302를 사용해도 큰 문제 없음**

## 기타 리다이렉션

300, 304

- ~~300 Multiple Choices: 안쓴다.~~
- 304 Not Modified
    - 캐시를 목적으로 사용
    - 클라이언트에게 리소스가 수정되지 않았음을 알려준다. 따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. (캐시로 리다이렉트 한다.)
    - 304 응답은 응답에 메시지 바디를 포함하면 안된다. (로컬 캐시를 사용해야 하므로)
    - 조건부 GET, HEAD 요청시 사용
    

# 4xx (클라이언트 오류), 5xx (서버 오류)

## 4xx Client Error

- 클라이언트의 요청에 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 오류의 원인이 클라이언트에 있음
- 중요! 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에, 똑같은 재시도가 실패함

→ 똑같은 요청을 다시보내도 무조건 실패만 나옴

## 400 Bad Request

클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음

- 요청 구문, 메시지 등등 오류
- 클라이언트는 요청 내용을 다시 검토하고, 보내야함
- 예) 요청 파라미터가 잘못되거나, API 스펙이 맞지 않을 때

→ 서버에서 철저하게 분류하여 400으로 보내야 함 

→ 500이면 서버 오류라고 판단할 수 있음

## 401 Unauthorized

클라이언트가 해당 리소스에 대한 인증이 필요함

- 인증(Authentication) 되지 않음
- 401 오류 발생시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명 필요
- 참고
    - 인증(Authentication): 본인이 누구인지 확인 (로그인)
    - 인가(Authorization): 권한 레벨 (ADMIN 권한처럼 특정 리소스에 접근할 수 있는 권한, 인증이 있어야 인가가 있음)
    - 오류 메시지가 Unauthorized 이지만 인증 되지 않음 (이름이 아쉬움)

→ 인증은 로그인, 인가는 권한

## 403 Forbidden

서버가 요청을 이해했지만 승인을 거부함

- 주로 인증 자격 증명은 있지만, 접근 권한이 불충분한 경우
- 예) 어드민 등급이 아닌 사용자가 로그인은 했지만, 어드민 등급의 리소스에 접근하는 경우

## 404 Not Found

요청 리소스를 찾을 수 없음

- 요청 리소스가 서버에 없음
- 또는 클라이언트가 권한이 부족한 리소스에 접근할 떄 해당 리소스를 숨기고 싶을 때

→ 403을 내지 않고 있는지 없는지 여부까지 그냥 숨기고 싶을 때

## 5xx Server Error

서버 오류

- 서버 문제로 오류 발생
- 서버가 복구가 되었다면 실행될 수도 있음

→ 서버 개발자가 문제를 서버 에러를 직접 만들면 안됨

→ 서버에 문제가 있을 때를 모니터링 하는 것과 로직적으로 문제가 있을 때 모니터링 하는게 섞일 수 있음

- ex) 20대 이상만 구매 가능한 물건을 15세가 구매하려는 경우 : 비즈니스 로직상 예외 케이스

## 500 Internal Server Error

서버 문제로 오류 발생, 애매하면 500 오류

- 서버 내부 문제로 오류 발생
- 애매하면 500 오류

## 503 Service Unavailable

서비스 이용 불가

- 서버가 일시적인 과부하 또는 예정된 적업으로 잠시 요청을 처리할 수 없음
- 얼마 뒤에 복구될지 보여줄 수 있음